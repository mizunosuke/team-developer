<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> G'sから現在地に地図移動</title>
</head>

<body>
    <h2>G'sから現在地に地図移動</h2>
    <p>いじってみている最中</p>
    <input type="text" id="title">
    <button id="btn">データ取得</button>

    <div id="gmap" style="height:800px;width:1000px"></div>


    <!-- 33.5860037
    130.3957793 -->
    <script>
        function initMap() {
            var target = document.getElementById('gmap');
            var current_location = { lat: 33.58628322989272, lng: 130.3960128298927 };  //最初の表示をG'sにしている
            var map = new google.maps.Map(document.getElementById('gmap'), {
                center: current_location,
                zoom: 16
            });
            const marker = new google.maps.Marker({
                position: current_location,
                map: map,
            });
            //情報ウィンドウのインスタンスの生成（後でマーカーに紐付け）
            var infowindow = new google.maps.InfoWindow();

            //PlacesService のインスタンスの生成（引数に map を指定）
            var service = new google.maps.places.PlacesService(map);

            if (!navigator.geolocation) {
                //情報ウィンドウの位置をマップの中心位置に指定
                infowindow.setPosition(map.getCenter());
                //情報ウィンドウのコンテンツを設定
                infowindow.setContent;
                //情報ウィンドウを表示
                infowindow.open(map);
            }

            // ブラウザが対応している場合、position にユーザーの位置情報が入る
            navigator.geolocation.getCurrentPosition(function (position) {
                //position から緯度経度（ユーザーの位置）のオブジェクトを作成し変数に代入
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                //情報ウィンドウに現在位置を指定
                infowindow.setPosition(pos);
                //情報ウィンドウのコンテンツを設定
                infowindow.setContent('現在位置を取得しました。');
                console.log(infowindow);
                //情報ウィンドウを表示
                infowindow.open(map);
                //マップの中心位置を指定
                map.setCenter(pos);

                //種類（タイプ）やキーワードをもとに施設を検索（プレイス検索）するメソッド nearbySearch()

                // service = new google.maps.places.PlacesService(map);
                // service.textSearch(request, callback);

                service.nearbySearch({
                    location: pos,  //検索するロケーション
                    radius: 500000,  //検索する半径（メートル）
                    name: ['法務局']  //nameで検索。文字列またはその配列で指定
                    //キーワードで検索する場合は name:'レストラン' や ['レストラン','中華'] のように指定 typeもある


                }, callback);  //コールバック関数（callback）は別途定義

                //コールバック関数には results, status が渡されるので、status により条件分岐
                function callback(results, status) {
                    console.log(results);
                    // console.log(results[0].place_id);
                    // status は以下のような定数で判定（OK の場合は results が配列で返ってきます）
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        //results の数だけ for 文で繰り返し処理
                        for (var i = 0; i < results.length; i++) {
                            //createMarker() はマーカーを生成する関数（別途定義）
                            createMarker(results[i]);
                            console.log(results[i].place_id);
                        }
                    }
                }
            }, function () {  //位置情報の取得をユーザーがブロックした場合のコールバック
                //情報ウィンドウの位置をマップの中心位置に指定
                infowindow.setPosition(map.getCenter());
                //情報ウィンドウのコンテンツを設定
                infowindow.setContent('Error: Geolocation が無効です。');
                //情報ウィンドウを表示
                infowindow.open(map);
            });

            //マーカーを生成する関数（引数には検索結果の配列 results[i] が入ってきます）
            function createMarker(place) {
                //var placeLoc = place.geometry.location; 
                var marker = new google.maps.Marker({
                    map: map,
                    position: place.geometry.location  //results[i].geometry.location
                });

                //マーカーにイベントリスナを設定
                marker.addListener('click', function () {
                    infowindow.setContent(place.name);  //results[i].name
                    infowindow.open(map, this);
                });
            }
        }

    </script>

    <script>
        service = new google.maps.places.PlacesService(map);
        service.textSearch(request, callback);
    </script>


    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBITw3qtjftlpePJ85f8FbW3h3qni4JHZw&callback=initMap&libraries=places"
        async defer></script>
    <!-- Placesを使用する場合は最後に「&libraries=places」を追加する必要があります。 -->




</body>

</html>